<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Photo Grid</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .photo-card {
      position: relative;
      overflow: hidden;
    }

    .lock-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .price-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
    }

    .unlock-button {
      transition: all 0.3s ease;
    }

    .unlock-button:hover {
      transform: scale(1.05);
    }

    .pagination {
      margin-top: 2rem;
    }
    .photo-card {
      position: relative;
      overflow: hidden;
      transition: transform 0.2s;
    }

    .photo-card:hover {
      transform: translateY(-5px);
    }

    .lock-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      pointer-events: none;
    }

    .price-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      z-index: 2;
    }

    .unlock-button {
      transition: all 0.3s ease;
    }

    .unlock-button:hover {
      transform: scale(1.05);
      background-color: #0056b3;
    }

    /* Стили для ссылки на фото */
    .photo-card a {
      display: block;
      position: relative;
      overflow: hidden;
    }

    .photo-card a:hover img {
      transform: scale(1.05);
      transition: transform 0.3s ease;
    }
  </style>
</head>
<body>
<div class="container py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
<!--    <h2 th:text="${photoOwner.username + '\'s Photos'}">User's Photos</h2>-->
<!--    <div class="user-balance" th:if="${currentUser != null}">-->
      Balance: <i class="fas fa-coins"></i>
<!--      <span th:text="${#numbers.formatDecimal(currentUser.balance, 1, 2)}">0.00</span>-->
    </div>
  </div>

  <!-- Alert Messages -->
  <div th:if="${success}" class="alert alert-success" role="alert">
    <span th:text="${success}"></span>
  </div>
  <div th:if="${error}" class="alert alert-danger" role="alert">
    <span th:text="${error}"></span>
  </div>

  <!-- Photo Grid -->
<div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
  <div class="col" th:each="photo : ${photos}">
    <div class="card photo-card h-100">
      <!-- Контейнер для фото с оверлеем -->
      <div class="position-relative">
        <!-- Фото с ссылкой -->
        <a th:href="@{/photos/{id}(id=${photo.id})}" class="text-decoration-none">
          <img th:src="@{'data:image/jpeg;base64,' + ${photo.photoBase64}}"
               class="card-img-top"
               style="height: 300px; object-fit: cover;"
               th:alt="${photo.description}">
        </a>

        <!-- Оверлей только для заблокированных и неразблокированных фото -->
        <div th:if="${photo.isLocked && !isPhotoUnlocked.apply(photo) && currentUsername != photoOwner.username}"
             class="lock-overlay">
          <i class="fas fa-lock fa-2x"></i>
        </div>

        <!-- Бейдж с ценой только для заблокированных и неразблокированных фото -->
        <div th:if="${photo.isLocked && !isPhotoUnlocked.apply(photo) && currentUsername != photoOwner.username}"
             class="price-badge">
          <i class="fas fa-coins"></i>
          <span th:text="${photo.price}"></span>
        </div>
      </div>

      <div class="card-body">
        <p class="card-text" th:text="${photo.description}"></p>
        <span th:if="${photo.isNSFW}"
              class="badge bg-danger mb-2">NSFW</span>
      </div>

      <!-- Форма разблокировки только если фото заблокировано и ещё не разблокировано -->
      <div th:if="${photo.isLocked && !isPhotoUnlocked.apply(photo) && currentUsername != null && currentUsername != photoOwner.username}"
           class="card-footer bg-transparent border-0 p-3">
        <form th:action="@{/photos/{id}/unlock(id=${photo.id})}"
              method="post"
              class="unlock-form">
          <button type="submit"
                  class="btn btn-primary w-100 unlock-button">
            <i class="fas fa-unlock me-2"></i>
            Unlock for <span th:text="${photo.price}"></span> coins
          </button>
        </form>
      </div>

      <!-- Бейдж для разблокированных фото -->
      <div th:if="${isPhotoUnlocked.apply(photo)}"
           class="card-footer bg-transparent border-0 text-center">
        <span class="badge bg-success">
          <i class="fas fa-check me-1"></i> Unlocked
        </span>
      </div>
    </div>
  </div>
</div>


  <!-- Pagination -->
  <nav th:if="${totalPages > 1}" class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item" th:classappend="${currentPage == 0 ? 'disabled' : ''}">
        <a class="page-link"
           th:href="@{/photos/user/{username}/photos(username=${photoOwner.username},page=${currentPage - 1})}">
          Previous
        </a>
      </li>

      <li class="page-item"
          th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
          th:classappend="${pageNum == currentPage ? 'active' : ''}">
        <a class="page-link"
           th:href="@{/photos/user/{username}/photos(username=${photoOwner.username},page=${pageNum})}"
           th:text="${pageNum + 1}">1</a>
      </li>

      <li class="page-item" th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}">
        <a class="page-link"
           th:href="@{/photos/user/{username}/photos(username=${photoOwner.username},page=${currentPage + 1})}">
          Next
        </a>
      </li>
    </ul>
  </nav>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>